<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Post - Tech Trails</title>
    <!-- TinyMCE CDN -->
    <script
      src="https://cdn.tiny.cloud/1/<%= tinyMCEApiKey %>/tinymce/7/tinymce.min.js"
      referrerpolicy="origin"
    ></script>
    <link rel="stylesheet" href="/styles/create.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <a href="/">Tech Trails</a>
      </div>
      <div class="post-controls">
        <button class="tab-btn" id="edit-tab">Edit</button>
        <button class="tab-btn" id="preview-tab">Preview</button>
        <button class="close-btn" id="close-btn">X</button>
      </div>
    </header>

    <!-- Create Post Container -->
    <main class="create-post-container">
      <form id="create-post-form" action="/create" method="POST">
        <!-- Cover Image Button -->
        <button type="button" class="add-cover-btn">+ Add Cover Image</button>

        <!-- Post Title Input -->
        <input
          type="text"
          name="title"
          class="post-title"
          placeholder="Post title..."
          required
        />

        <!-- Editor Container to Allow Dynamic Height -->
        <div class="editor-container">
          <textarea id="post-editor" name="content"></textarea>
        </div>

        <!-- Hidden Input for Status -->
        <input type="hidden" name="status" id="post-status" value="draft" />

        <!-- Post Action Buttons -->
        <div class="post-actions">
          <button
            type="submit"
            class="publish-btn"
            onclick="setPostStatus('published')"
          >
            Publish
          </button>
          <button
            type="submit"
            class="save-draft-btn"
            onclick="setPostStatus('draft')"
          >
            Save Draft
          </button>
          <button type="reset" class="revert-btn">Revert New Changes</button>
        </div>
      </form>
    </main>

    <!-- TinyMCE Initialization -->
    <script>
      function adjustEditorHeight() {
        const editor = tinymce.get("post-editor");
        if (editor) {
          const editorContainer = document.querySelector(".editor-container");
          if (editorContainer) {
            let newHeight =
              window.innerHeight -
              editorContainer.getBoundingClientRect().top -
              20;
            editor.theme.resizeTo("100%", newHeight);
          }
        }
      }

      tinymce.init({
        selector: "#post-editor",
        plugins: "lists link image code textcolor autosave",
        toolbar:
          "undo redo | bold italic | bullist numlist | link image | code | restoredraft",
        /* Force editor to use 100% width of its container */
        width: "100%",
        /* Optional: Let users manually resize the editor from the bottom-right corner */
        resize: true,

        // Autosave settings
        autosave_ask_before_unload: true, // Ask user before leaving if there's unsaved content
        autosave_interval: "10s", // Save every 30 seconds
        autosave_retention: "30m", // Retain autosaved data for 30 minutes
      });

      window.addEventListener("resize", () => {
        const editor = tinymce.get("post-editor");
        if (editor) {
          // Example: resize to 80% of current window height
          // or any formula you like
          editor.theme.resizeTo("100%", window.innerHeight * 0.8);
        }
      });

      // Adjust height dynamically on window resize
      window.addEventListener("resize", adjustEditorHeight);

      function setPostStatus(status) {
        document.getElementById("post-status").value = status;
      }
    </script>
  </body>
</html>
